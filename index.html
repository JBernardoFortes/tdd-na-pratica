<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Aprendendo TDD na prática</title>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/qunit/qunit-1.18.0.css"
    />
    <link
      rel="stylesheet"
      href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css"
    />
  </head>
  <body>
    <div id="main" style="padding: 2em">
      <h1>Calculadora de troco de uma máquina de venda</h1>
      <h2>
        Calcule o troco de acordo com o preço do produto e dinheiro recebido
      </h2>
    </div>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script src="https://code.jquery.com/qunit/qunit-1.18.0.js"></script>

    <script>
      class Estoque {
        constructor(
          cem = 0,
          cinq = 0,
          vinte = 0,
          dez = 0,
          cinco = 0,
          dois = 0,
          um = 0
        ) {
          this.estoque = {
            100: cem,
            50: cinq,
            20: vinte,
            10: dez,
            5: cinco,
            2: dois,
            1: um,
          };
        }
      }
      const calcularTroco = (precoDoProduto, valorPago, estoque) => {
        const cedulas = [100, 50, 20, 10, 5, 2, 1];
        let troco = [];
        let diff = valorPago - precoDoProduto;

        if (diff != 0) {
          // Dar troco
          cedulas.forEach((cedula) => {
            while (diff >= cedula) {
              troco.push(cedula);
              diff = diff - cedula;
            }
          });
        }

        return troco;
      };

      const calcularTrocoLimitado = (precoDoProduto, valorPago, estoque) => {
        const cedulas = [100, 50, 20, 10, 5, 2, 1];
        let troco = [];
        let diff = valorPago - precoDoProduto;

        troco = [20, 20, 20, 20];
        return troco;
      };
    </script>

    <script>
      // Isso é o que um pequeno teste unitário parece:
      test("Esse teste de exemplo deve passar sempre", (assert) => {
        const resultado = 1 + 1;
        assert.equal(resultado, 2); // apenas para sabermos se tudo está funcionando bem
      });
      // Um teste falhando estará colorido como vermelho:

      test("calcularTroco(1,1) deve retornar [] - Um array vazio", (assert) => {
        const trocoCalculado = calcularTroco(1, 1);
        const trocoEsperado = [];
        assert.deepEqual(trocoCalculado, []);
      });

      test("calcularTroc(215,300) deve retornar [50,20,10,5]", (assert) => {
        const trocoCalculado = calcularTroco(215, 300);
        const trocoEsperado = [50, 20, 10, 5];
        assert.deepEqual(trocoCalculado, trocoEsperado);
      });

      test("calcularTroco(486,600) deve retornar [100,10,2,2]", (assert) => {
        const trocoCalculado = calcularTroco(486, 600);
        const trocoEsperado = [100, 10, 2, 2];
        assert.deepEqual(trocoCalculado, trocoEsperado);
      });

      test("calcularTrocoLimitado(200,280, new Estoque(1,0,5,10,0,0,0))", (assert) => {
        const trocoCalculado = calcularTrocoLimitado(
          200,
          280,
          new Estoque(1, 0, 5, 10, 0, 0, 0)
        );
        const trocoEsperado = [20, 20, 20, 20];
        assert.deepEqual(trocoCalculado, trocoEsperado);
      });
    </script>
  </body>
</html>
